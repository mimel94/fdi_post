<!DOCTYPE html>
<html>
    <body>
        <video playsinline="" autoplay="" width="320" height="240"></video>
        <canvas width="320" height="240"></canvas>
        <button onclick="entrenar()">Entrenar</button>
        <button onclick="validar()">Validar</button>
        <script>
            const video = document.querySelector('video');
            const canvas = window.canvas = document.querySelector('canvas');

            async function init ()  {
                const stream = await navigator.mediaDevices.getUserMedia({audio: false,video: true});
                window.stream = stream;
                video.srcObject = stream;
            }

            function getImage() {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                // var dataURL = canvas.toDataURL()
                // console.log(dataURL)
            }

            function entrenar() {
                var data64 = canvas.toDataURL();                
                socketAsyn.send('{"data":"'+data64+'","accion":"entrenar"}');                                
                console.log("enviado?");
            }
            function validar(){
                var data64 = canvas.toDataURL();                
                socketAsyn.send('{"data":"'+data64+'","accion":"validar"}');
                console.log('validado?')
            }

            init();
            var socketAsyn = new WebSocket("ws://192.168.100.218:8080/ws?room=viclass");
            socketAsyn.onmessage = function(e) { console.log(e.data); };
            socketAsyn.onopen = function() { console.log("abierto"); };
            socketAsyn.onerror = function(e){ console.log(e); }
            setInterval(function(){getImage()}, 1000 / 25);
        </script>
    </body>
</html>